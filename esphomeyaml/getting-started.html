<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><meta http-equiv="X-UA-Compatible"content="IE=Edge"><meta http-equiv="Content-Type"content="text/html; charset=utf-8"><title>Getting Started with esphomeyaml &#8212; esphomelib 1.5.3 documentation</title><link rel="stylesheet"href="../_static/alabaster.css"type="text/css"><link rel="stylesheet"href="../_static/pygments.css"type="text/css"><script src="../_static/documentation_options.js"></script><script src="../_static/jquery.js"></script><script src="../_static/underscore.js"></script><script src="../_static/doctools.js"></script><link rel="index"title="Index"href="../genindex.html"><link rel="search"title="Search"href="../search.html"><link rel="stylesheet"href="../_static/custom.css"type="text/css"><meta name="viewport"content="width=device-width,initial-scale=0.9,maximum-scale=0.9"><div class="document"><div class="documentwrapper"><div class="bodywrapper"><div class="body"role="main"><div class="section"id="getting-started-with-esphomeyaml"><h1>Getting Started with esphomeyaml<a class="headerlink"href="#getting-started-with-esphomeyaml"title="Permalink to this headline">¬∂</a></h1><p>esphomeyaml is the perfect solution for creating custom firmwares for your ESP8266/ESP32 boards. In this guide we‚Äôll go through how to setup a basic ‚Äúnode‚Äù in a few simple steps.<div class="section"id="installation"><h2>Installation<a class="headerlink"href="#installation"title="Permalink to this headline">¬∂</a></h2><p>Installing epshomeyaml is very easy. All you need to do is have <a class="reference external"href="https://www.python.org/download/releases/2.7/">Python 2.7</a> installed (because of platformio üòï) and install the console script script through <code class="docutils literal notranslate"><span class="pre">pip</span></code>.<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">esphomeyaml</span>
</pre></div></div><p>Alternatively, there‚Äôs also a docker image available for easy installation:<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">pull</span> <span class="n">ottowinter</span><span class="o">/</span><span class="n">esphomeyaml</span>
</pre></div></div></div><div class="section"id="creating-a-project"><h2>Creating A Project<a class="headerlink"href="#creating-a-project"title="Permalink to this headline">¬∂</a></h2><p>Now let‚Äôs setup a configuration file. Fortunately, esphomeyaml has a friendly setup wizard that will guide you through creating your first configuration file. For example, if you want to create a configuration file called <code class="docutils literal notranslate"><span class="pre">livingroom.yaml</span></code>:<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">esphomeyaml</span> <span class="n">livingroom</span><span class="o">.</span><span class="n">yaml</span> <span class="n">wizard</span>
<span class="c1"># On Docker:</span>
<span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">rm</span> <span class="o">-</span><span class="n">v</span> <span class="s2">&quot;`pwd`&quot;</span><span class="p">:</span><span class="o">/</span><span class="n">config</span> <span class="o">-</span><span class="n">it</span> <span class="n">ottowinter</span><span class="o">/</span><span class="n">esphomeyaml</span> <span class="n">livingroom</span><span class="o">.</span><span class="n">yaml</span> <span class="n">wizard</span>
</pre></div></div><p>At the end of this step, you will have your first YAML configuration file ready. It doesn‚Äôt do much yet and only makes your device connect to the WiFi network and MQTT broker, but still it‚Äôs a first step.</div><div class="section"id="adding-some-features"><h2>Adding some features<a class="headerlink"href="#adding-some-features"title="Permalink to this headline">¬∂</a></h2><p>So now you should have a file called <code class="docutils literal notranslate"><span class="pre">livingroom.yaml</span></code> (or similar). Go open that file in an editor of your choice and let‚Äôs add a <a class="reference external"href="/esphomeyaml/components/switch/gpio.html">simple GPIO switch</a> to our app.<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">switch</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">platform</span><span class="p">:</span> <span class="n">gpio</span>
    <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;Living Room Dehumidifer&quot;</span>
    <span class="n">pin</span><span class="p">:</span> <span class="mi">5</span>
</pre></div></div><p>The configuration format should hopefully immediately seem similar to you. esphomeyaml has tried to keep it as close to Home Assistant‚Äôs <code class="docutils literal notranslate"><span class="pre">configuration.yaml</span></code> schema as possible. In above example, we‚Äôre simply adding a switch that‚Äôs called ‚ÄúLiving Room Relay‚Äù (could control anything really, for example lights) and is connected to pin <code class="docutils literal notranslate"><span class="pre">GPIO5</span></code>. The nice thing about esphomeyaml is that it will automatically also try to translate pin numbers for you based on the board. For example in above configuration, if using a NodeMCU board, you could have just as well set <code class="docutils literal notranslate"><span class="pre">D1</span></code> as the <code class="docutils literal notranslate"><span class="pre">pin:</span></code> option.</div><div class="section"id="first-uploading"><h2>First Uploading<a class="headerlink"href="#first-uploading"title="Permalink to this headline">¬∂</a></h2><p>Now you can go ahead and add some more components. Once you feel like you have something you want to upload to your ESP board, simply plug in the device via USB and type the following command (replacing <code class="docutils literal notranslate"><span class="pre">livingroom.yaml</span></code> with your configuration file):<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">esphomeyaml</span> <span class="n">livingroom</span><span class="o">.</span><span class="n">yaml</span> <span class="n">run</span>
</pre></div></div><p>You should see esphomeyaml validating the configuration and telling you about potential problems. Then esphomeyaml will proceed to compile and upload the custom firmware. You will also see that esphomeyaml created a new folder with the name of your node. This is a new platformio project that you can modify afterwards and play around with.<p>On docker, the first upload is a bit more complicated, either you manage to map the serial device into docker with the <code class="docutils literal notranslate"><span class="pre">-v</span></code> option, or you just call <code class="docutils literal notranslate"><span class="pre">compile</span></code> within the container and let platformio do the uploading on the host system:<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">rm</span> <span class="o">-</span><span class="n">v</span> <span class="s2">&quot;`pwd`&quot;</span><span class="p">:</span><span class="o">/</span><span class="n">config</span> <span class="o">-</span><span class="n">it</span> <span class="n">ottowinter</span><span class="o">/</span><span class="n">esphomeyaml</span> <span class="n">livingroom</span><span class="o">.</span><span class="n">yaml</span> <span class="nb">compile</span>
<span class="n">platformio</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="n">livingroom</span> <span class="o">-</span><span class="n">t</span> <span class="n">upload</span>
</pre></div></div><p>Now if you have <a class="reference external"href="https://www.home-assistant.io/docs/mqtt/discovery/">MQTT Discovery</a> enabled in your Home Assistant configuration, the switch should already be automatically be added üéâ (Make sure you‚Äôve added it to a view too.)<p><img alt="image0"class="align-center"src="../_images/gpio1.png"><p>After the first upload, you will probably never need to use the USB cable again, as all features of esphomelib are enabled remotely as well. No more opening hidden boxes stowed in places hard to reach. Yay!</div><div class="section"id="adding-a-binary-sensor"><h2>Adding A Binary Sensor<a class="headerlink"href="#adding-a-binary-sensor"title="Permalink to this headline">¬∂</a></h2><p>Next, we‚Äôre going to add a very simple binary sensor that periodically checks a GPIO pin whether it‚Äôs pulled high or low - the <a class="reference external"href="/esphomeyaml/components/binary_sensor/gpio.html">GPIO Binary Sensor</a>.<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">binary_sensor</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">platform</span><span class="p">:</span> <span class="n">gpio</span>
    <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;Living Room Window&quot;</span>
    <span class="n">pin</span><span class="p">:</span>
      <span class="n">number</span><span class="p">:</span> <span class="mi">16</span>
      <span class="n">inverted</span><span class="p">:</span> <span class="kc">True</span>
      <span class="n">mode</span><span class="p">:</span> <span class="n">INPUT_PULLUP</span>
</pre></div></div><p>This is an advanced feature of esphomeyaml, almost all pins can optionally have a more complicated configuration schema with options for inversion and pinMode - the <a class="reference external"href="/esphomeyaml/configuration-types.html#pin-schema">Pin Schema</a>.<p>This time when uploading, you don‚Äôt need to have the device plugged in through USB again. The upload will magically happen ‚Äúover the air‚Äù. Using esphomeyaml directly, this is the same as from a USB cable, but for docker you need to supply an additional parameter:<div class="code bash highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">esphomeyaml</span> <span class="n">livingroom</span><span class="o">.</span><span class="n">yaml</span> <span class="n">run</span>
<span class="c1"># On docker</span>
<span class="n">docker</span> <span class="n">run</span> <span class="o">--</span><span class="n">rm</span> <span class="o">-</span><span class="n">p</span> <span class="mi">6123</span><span class="p">:</span><span class="mi">6123</span> <span class="o">-</span><span class="n">v</span> <span class="s2">&quot;`pwd`&quot;</span><span class="p">:</span><span class="o">/</span><span class="n">config</span> <span class="o">-</span><span class="n">it</span> <span class="n">ottowinter</span><span class="o">/</span><span class="n">esphomeyaml</span> <span class="n">livingroom</span><span class="o">.</span><span class="n">yaml</span> <span class="n">run</span>
</pre></div></div><p><img alt="image1"src="../_images/gpio.png"></div><div class="section"id="where-to-go-next"><h2>Where To Go Next<a class="headerlink"href="#where-to-go-next"title="Permalink to this headline">¬∂</a></h2><p>Great üéâ! You‚Äôve now successfully setup your first esphomeyaml project and uploaded your first esphomelib custom firmware to your node. You‚Äôve also learned how to enable some basic components via the configuration file.<p>So now is a great time to go take a look at the <a class="reference external"href="/esphomeyaml/index.html">Components Index</a>, hopefully you‚Äôll find all sensors/outputs/‚Ä¶ you‚Äôll need in there. If you‚Äôre having any problems or want new features, please either create a new issue on the <a class="reference external"href="https://github.com/OttoWinter/esphomeyaml/issues">GitHub issue tracker</a> or contact me via the <a class="reference external"href="https://discord.gg/KhAMKrd">Discord chat</a>.</div><div class="section"id="using-custom-components"><h2>Using Custom components<a class="headerlink"href="#using-custom-components"title="Permalink to this headline">¬∂</a></h2><p>esphomelib‚Äôs powerful core makes it easy to create own custom sensors. Please first follow the <a class="reference external"href="https://github.com/OttoWinter/esphomelib/wiki/Custom-Sensor-Component">Custom Sensor Component Guide</a> to see how this can be done. For using custom components with esphomeyaml you only need to open up the auto-generated <code class="docutils literal notranslate"><span class="pre">src/main.cpp</span></code> file in the platformio project folder. The lines in between <code class="docutils literal notranslate"><span class="pre">AUTO</span> <span class="pre">GENERATED</span> <span class="pre">CODE</span> <span class="pre">BEGIN</span></code> and <code class="docutils literal notranslate"><span class="pre">AUTO</span> <span class="pre">GENERATED</span> <span class="pre">CODE</span> <span class="pre">END</span></code> should not be edited and all changes in there will be overriden, but outside of those comments you can safely create custom sensors while still using esphomeyaml‚Äôs great configuration options.<div class="code cpp highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Auto</span> <span class="n">generated</span> <span class="n">code</span> <span class="n">by</span> <span class="n">esphomeyaml</span>
<span class="c1">#include &quot;esphomelib/application.h&quot;</span>

<span class="n">using</span> <span class="n">namespace</span> <span class="n">esphomelib</span><span class="p">;</span>

<span class="n">void</span> <span class="n">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="o">//</span> <span class="o">=====</span> <span class="n">DO</span> <span class="n">NOT</span> <span class="n">EDIT</span> <span class="n">ANYTHING</span> <span class="n">BELOW</span> <span class="n">THIS</span> <span class="n">LINE</span> <span class="o">=====</span>
  <span class="o">//</span> <span class="o">==========</span> <span class="n">AUTO</span> <span class="n">GENERATED</span> <span class="n">CODE</span> <span class="n">BEGIN</span> <span class="o">===========</span>
  <span class="n">App</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s2">&quot;cabinet&quot;</span><span class="p">);</span>
  <span class="o">//</span> <span class="o">...</span>
  <span class="o">//</span> <span class="o">===========</span> <span class="n">AUTO</span> <span class="n">GENERATED</span> <span class="n">CODE</span> <span class="n">END</span> <span class="o">============</span>
  <span class="o">//</span> <span class="o">=========</span> <span class="n">YOU</span> <span class="n">CAN</span> <span class="n">EDIT</span> <span class="n">AFTER</span> <span class="n">THIS</span> <span class="n">LINE</span> <span class="o">=========</span>
  <span class="n">App</span><span class="o">.</span><span class="n">setup</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">void</span> <span class="n">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">App</span><span class="o">.</span><span class="n">loop</span><span class="p">();</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
<span class="p">}</span>
</pre></div></div></div></div></div></div></div><div class="sphinxsidebar"role="navigation"aria-label="main navigation"><div class="sphinxsidebarwrapper"><div class="relations"><h3>Related Topics</h3><ul><li><a href="../index.html">Documentation overview</a><ul></ul></ul></div><div id="searchbox"style="display: none"role="search"><h3>Quick search</h3><div class="searchformwrapper"><form class="search"action="../search.html"><input name="q"> <input type="submit"value="Go"> <input type="hidden"name="check_keywords"value="yes"> <input type="hidden"name="area"value="default"></form></div></div><script>$('#searchbox').show(0);</script></div></div><div class="clearer"></div></div><div class="footer">&copy;2018, Otto Winter. | Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.2</a> &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a> | <a href="../_sources/esphomeyaml/getting-started.rst.txt"rel="nofollow">Page source</a></div>