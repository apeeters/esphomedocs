<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><meta http-equiv="X-UA-Compatible"content="IE=Edge"><meta http-equiv="Content-Type"content="text/html; charset=utf-8"><title>Power Supply &#8212; esphomelib 1.6.2 documentation</title><link rel="stylesheet"href="../../_static/alabaster.css"type="text/css"><link rel="stylesheet"href="../../_static/pygments.css"type="text/css"><script src="../../_static/documentation_options.js"></script><script src="../../_static/jquery.js"></script><script src="../../_static/underscore.js"></script><script src="../../_static/doctools.js"></script><link rel="index"title="Index"href="../../genindex.html"><link rel="search"title="Search"href="../../search.html"><link rel="next"title="Controller"href="controller.html"><link rel="prev"title="Logging Engine"href="log.html"><link rel="stylesheet"href="../../_static/custom.css"type="text/css"><meta name="viewport"content="width=device-width,initial-scale=0.9,maximum-scale=0.9"><div class="document"><div class="documentwrapper"><div class="bodywrapper"><div class="body"role="main"><div class="section"id="power-supply"><h1>Power Supply<a class="headerlink"href="#power-supply"title="Permalink to this headline">¶</a></h1><div class="section"id="example-usage"><h2>Example Usage<a class="headerlink"href="#example-usage"title="Permalink to this headline">¶</a></h2><div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Basic</span>
<span class="k">auto</span> <span class="o">*</span><span class="n">power_supply</span> <span class="o">=</span> <span class="n">App</span><span class="p">.</span><span class="n">make_power_supply</span><span class="p">(</span><span class="mi">12</span><span class="p">);</span>
<span class="c1">// Inverted, for ATX</span>
<span class="k">auto</span> <span class="o">*</span><span class="n">atx</span> <span class="o">=</span> <span class="n">App</span><span class="p">.</span><span class="n">make_power_supply</span><span class="p">(</span><span class="n">GPIOOutputPin</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">,</span> <span class="nb">true</span><span class="p">));</span>
</pre></div></div></div><div class="section"id="api-reference"><h2>API Reference<a class="headerlink"href="#api-reference"title="Permalink to this headline">¶</a></h2><div class="section"id="powersupplycomponent"><h3>PowerSupplyComponent<a class="headerlink"href="#powersupplycomponent"title="Permalink to this headline">¶</a></h3><dl class="class"><dt id="_CPPv320PowerSupplyComponent"><span id="_CPPv220PowerSupplyComponent"></span><span id="PowerSupplyComponent"></span><span class="target"id="class_power_supply_component"></span><em class="property">class </em><code class="descname">PowerSupplyComponent</code><a class="headerlink"href="#_CPPv320PowerSupplyComponent"title="Permalink to this definition">¶</a><br><dd><p>This class represents an power supply.<p>The power supply will automatically be turned on if a component requests high power and will automatically be turned off again keep_on_time (ms) after the last high-power request is cancelled. Aditionally, an enable_time (ms) can be specified because many power supplies only actually provide high-power output after a few milliseconds.<p>Use the pin argument of the <a class="reference internal"href="application.html#class_application"><span class="std std-ref">Application</span></a> helper to enable inverted mode. For example most ATX power supplies operate in inverted mode, so to turn them on you have to pull the pin LOW.<p>To request high power mode, a component must use the <a class="reference internal"href="#class_power_supply_component_1a4197f37ab311d5dbb3e5d20c6618e466"><span class="std std-ref">request_high_power()</span></a> function to register itself as needing high power mode. Once the high power mode is no longer required the component can use <a class="reference internal"href="#class_power_supply_component_1ae97ec12c786ca01924a9361d801da1d5"><span class="std std-ref">unrequest_high_power()</span></a> to unregister its high power mode. IMPORTANT: An component should NOT hold multiple requests to the same power supply, as the <a class="reference internal"href="#class_power_supply_component"><span class="std std-ref">PowerSupplyComponent</span></a> only holds an internal counter of how many high power requests have been made.<p>Usually though, all this should actually be handled by BinaryOutput and FloatOutput, since using this class correctly is not too easy.<p>Inherits from <a class="reference internal"href="component.html#class_component"><span class="std std-ref">Component</span></a><div class="breathe-sectiondef docutils container"><p class="breathe-sectiondef-title rubric">Public Functions<dl class="function"><dt id="_CPPv3N20PowerSupplyComponent20PowerSupplyComponentEP7GPIOPin8uint32_t8uint32_t"><span id="_CPPv2N20PowerSupplyComponent20PowerSupplyComponentEP7GPIOPin8uint32_t8uint32_t"></span><span id="PowerSupplyComponent::PowerSupplyComponent__GPIOPinP.uint32_t.uint32_t"></span><span class="target"id="class_power_supply_component_1a05fbd39cc5fe94bb04c38e073df883a3"></span><a class="reference internal"href="#_CPPv3N20PowerSupplyComponent20PowerSupplyComponentEP7GPIOPin8uint32_t8uint32_t"title="PowerSupplyComponent::PowerSupplyComponent">PowerSupplyComponent</a><code class="descname">PowerSupplyComponent</code><span class="sig-paren">(</span><a class="reference internal"href="helpers.html#_CPPv37GPIOPin"title="GPIOPin">GPIOPin</a> *<em>pin</em>, uint32_t <em>enable_time</em> = 20, uint32_t <em>keep_on_time</em> = 10000<span class="sig-paren">)</span><a class="headerlink"href="#_CPPv3N20PowerSupplyComponent20PowerSupplyComponentEP7GPIOPin8uint32_t8uint32_t"title="Permalink to this definition">¶</a><br><dd><p>Creates the <a class="reference internal"href="#class_power_supply_component"><span class="std std-ref">PowerSupplyComponent</span></a>.<p><dl class="docutils"><dt><strong>Parameters</strong><dd><ul class="breatheparameterlist first last simple"><li><code class="docutils literal notranslate"><span class="pre">pin</span></code>: The pin of the power supply control wire.<li><code class="docutils literal notranslate"><span class="pre">enable_time</span></code>: The time in milliseconds the power supply requires for power up. The thread will block in the meantime<li><code class="docutils literal notranslate"><span class="pre">keep_on_time</span></code>: The time in milliseconds the power supply should be kept on after the last high-power request.</ul></dl><p></dl><dl class="function"><dt id="_CPPv3N20PowerSupplyComponent16set_keep_on_timeE8uint32_t"><span id="_CPPv2N20PowerSupplyComponent16set_keep_on_timeE8uint32_t"></span><span id="PowerSupplyComponent::set_keep_on_time__uint32_t"></span><span class="target"id="class_power_supply_component_1a128cd31094aa7446e6daa97f899386b4"></span>void <a class="reference internal"href="#_CPPv320PowerSupplyComponent"title="PowerSupplyComponent">PowerSupplyComponent</a><code class="descname">set_keep_on_time</code><span class="sig-paren">(</span>uint32_t <em>keep_on_time</em><span class="sig-paren">)</span><a class="headerlink"href="#_CPPv3N20PowerSupplyComponent16set_keep_on_timeE8uint32_t"title="Permalink to this definition">¶</a><br><dd><p>Set the time in milliseconds the power supply should be kept on for after the last high-power request.</dl><dl class="function"><dt id="_CPPv3N20PowerSupplyComponent15set_enable_timeE8uint32_t"><span id="_CPPv2N20PowerSupplyComponent15set_enable_timeE8uint32_t"></span><span id="PowerSupplyComponent::set_enable_time__uint32_t"></span><span class="target"id="class_power_supply_component_1a76606812fee1b9e65af0995727f57f64"></span>void <a class="reference internal"href="#_CPPv320PowerSupplyComponent"title="PowerSupplyComponent">PowerSupplyComponent</a><code class="descname">set_enable_time</code><span class="sig-paren">(</span>uint32_t <em>enable_time</em><span class="sig-paren">)</span><a class="headerlink"href="#_CPPv3N20PowerSupplyComponent15set_enable_timeE8uint32_t"title="Permalink to this definition">¶</a><br><dd><p>Set the time in milliseconds the power supply needs for power-up.</dl><dl class="function"><dt id="_CPPv3NK20PowerSupplyComponent10is_enabledEv"><span id="_CPPv2NK20PowerSupplyComponent10is_enabledEv"></span><span id="PowerSupplyComponent::is_enabledC"></span><span class="target"id="class_power_supply_component_1a408eca847c0b32eb8735d78fdeb521d5"></span>bool <a class="reference internal"href="#_CPPv320PowerSupplyComponent"title="PowerSupplyComponent">PowerSupplyComponent</a><code class="descname">is_enabled</code><span class="sig-paren">(</span><span class="sig-paren">)</span> <em class="property">const</em><a class="headerlink"href="#_CPPv3NK20PowerSupplyComponent10is_enabledEv"title="Permalink to this definition">¶</a><br><dd><p>Is this power supply currently on?</dl><dl class="function"><dt id="_CPPv3N20PowerSupplyComponent18request_high_powerEv"><span id="_CPPv2N20PowerSupplyComponent18request_high_powerEv"></span><span id="PowerSupplyComponent::request_high_power"></span><span class="target"id="class_power_supply_component_1a4197f37ab311d5dbb3e5d20c6618e466"></span>void <a class="reference internal"href="#_CPPv320PowerSupplyComponent"title="PowerSupplyComponent">PowerSupplyComponent</a><code class="descname">request_high_power</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink"href="#_CPPv3N20PowerSupplyComponent18request_high_powerEv"title="Permalink to this definition">¶</a><br><dd><p>Request high power mode. Use <a class="reference internal"href="#class_power_supply_component_1ae97ec12c786ca01924a9361d801da1d5"><span class="std std-ref">unrequest_high_power()</span></a> to remove this request.</dl><dl class="function"><dt id="_CPPv3N20PowerSupplyComponent20unrequest_high_powerEv"><span id="_CPPv2N20PowerSupplyComponent20unrequest_high_powerEv"></span><span id="PowerSupplyComponent::unrequest_high_power"></span><span class="target"id="class_power_supply_component_1ae97ec12c786ca01924a9361d801da1d5"></span>void <a class="reference internal"href="#_CPPv320PowerSupplyComponent"title="PowerSupplyComponent">PowerSupplyComponent</a><code class="descname">unrequest_high_power</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink"href="#_CPPv3N20PowerSupplyComponent20unrequest_high_powerEv"title="Permalink to this definition">¶</a><br><dd><p>Un-request high power mode.</dl><dl class="function"><dt id="_CPPv3N20PowerSupplyComponent5setupEv"><span id="_CPPv2N20PowerSupplyComponent5setupEv"></span><span id="PowerSupplyComponent::setup"></span><span class="target"id="class_power_supply_component_1a56610f521b5b21d8bd5cd3625cb12e4b"></span>void <a class="reference internal"href="#_CPPv320PowerSupplyComponent"title="PowerSupplyComponent">PowerSupplyComponent</a><code class="descname">setup</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink"href="#_CPPv3N20PowerSupplyComponent5setupEv"title="Permalink to this definition">¶</a><br><dd><p>Register callbacks.</dl><dl class="function"><dt id="_CPPv3NK20PowerSupplyComponent18get_setup_priorityEv"><span id="_CPPv2NK20PowerSupplyComponent18get_setup_priorityEv"></span><span id="PowerSupplyComponent::get_setup_priorityC"></span><span class="target"id="class_power_supply_component_1ada362827252985bb58966ea4523c4c51"></span>float <a class="reference internal"href="#_CPPv320PowerSupplyComponent"title="PowerSupplyComponent">PowerSupplyComponent</a><code class="descname">get_setup_priority</code><span class="sig-paren">(</span><span class="sig-paren">)</span> <em class="property">const</em><a class="headerlink"href="#_CPPv3NK20PowerSupplyComponent18get_setup_priorityEv"title="Permalink to this definition">¶</a><br><dd><p>Hardware setup priority (+1).</dl><dl class="function"><dt id="_CPPv3NK20PowerSupplyComponent16get_keep_on_timeEv"><span id="_CPPv2NK20PowerSupplyComponent16get_keep_on_timeEv"></span><span id="PowerSupplyComponent::get_keep_on_timeC"></span><span class="target"id="class_power_supply_component_1ab41e627c0a2049742180b69105d0ff25"></span>uint32_t <a class="reference internal"href="#_CPPv320PowerSupplyComponent"title="PowerSupplyComponent">PowerSupplyComponent</a><code class="descname">get_keep_on_time</code><span class="sig-paren">(</span><span class="sig-paren">)</span> <em class="property">const</em><a class="headerlink"href="#_CPPv3NK20PowerSupplyComponent16get_keep_on_timeEv"title="Permalink to this definition">¶</a><br><dd><p>Get the keep on time.</dl><dl class="function"><dt id="_CPPv3NK20PowerSupplyComponent15get_enable_timeEv"><span id="_CPPv2NK20PowerSupplyComponent15get_enable_timeEv"></span><span id="PowerSupplyComponent::get_enable_timeC"></span><span class="target"id="class_power_supply_component_1a44f970359c11b94d0f3536303056eee3"></span>uint32_t <a class="reference internal"href="#_CPPv320PowerSupplyComponent"title="PowerSupplyComponent">PowerSupplyComponent</a><code class="descname">get_enable_time</code><span class="sig-paren">(</span><span class="sig-paren">)</span> <em class="property">const</em><a class="headerlink"href="#_CPPv3NK20PowerSupplyComponent15get_enable_timeEv"title="Permalink to this definition">¶</a><br><dd><p>Get the enable time.</dl></div><div class="breathe-sectiondef docutils container"><p class="breathe-sectiondef-title rubric">Protected Attributes<dl class="member"><dt id="_CPPv3N20PowerSupplyComponent4pin_E"><span id="_CPPv2N20PowerSupplyComponent4pin_E"></span><span id="PowerSupplyComponent::pin___GPIOPinP"></span><span class="target"id="class_power_supply_component_1aafc7e243687af51786c008a09e163058"></span><a class="reference internal"href="helpers.html#_CPPv37GPIOPin"title="GPIOPin">GPIOPin</a> *<a class="reference internal"href="#_CPPv320PowerSupplyComponent"title="PowerSupplyComponent">PowerSupplyComponent</a><code class="descname">pin_</code><a class="headerlink"href="#_CPPv3N20PowerSupplyComponent4pin_E"title="Permalink to this definition">¶</a><br><dd></dl><dl class="member"><dt id="_CPPv3N20PowerSupplyComponent8enabled_E"><span id="_CPPv2N20PowerSupplyComponent8enabled_E"></span><span id="PowerSupplyComponent::enabled___b"></span><span class="target"id="class_power_supply_component_1a56579a13fd30f9ff82e9bb26a7ff1fae"></span>bool <a class="reference internal"href="#_CPPv320PowerSupplyComponent"title="PowerSupplyComponent">PowerSupplyComponent</a><code class="descname">enabled_</code> = {false}<a class="headerlink"href="#_CPPv3N20PowerSupplyComponent8enabled_E"title="Permalink to this definition">¶</a><br><dd></dl><dl class="member"><dt id="_CPPv3N20PowerSupplyComponent12enable_time_E"><span id="_CPPv2N20PowerSupplyComponent12enable_time_E"></span><span id="PowerSupplyComponent::enable_time___uint32_t"></span><span class="target"id="class_power_supply_component_1abc7639dab0cb149f012e3d292e94f036"></span>uint32_t <a class="reference internal"href="#_CPPv320PowerSupplyComponent"title="PowerSupplyComponent">PowerSupplyComponent</a><code class="descname">enable_time_</code><a class="headerlink"href="#_CPPv3N20PowerSupplyComponent12enable_time_E"title="Permalink to this definition">¶</a><br><dd></dl><dl class="member"><dt id="_CPPv3N20PowerSupplyComponent13keep_on_time_E"><span id="_CPPv2N20PowerSupplyComponent13keep_on_time_E"></span><span id="PowerSupplyComponent::keep_on_time___uint32_t"></span><span class="target"id="class_power_supply_component_1aa4ef307709610dab041d0289259d5ac2"></span>uint32_t <a class="reference internal"href="#_CPPv320PowerSupplyComponent"title="PowerSupplyComponent">PowerSupplyComponent</a><code class="descname">keep_on_time_</code><a class="headerlink"href="#_CPPv3N20PowerSupplyComponent13keep_on_time_E"title="Permalink to this definition">¶</a><br><dd></dl><dl class="member"><dt id="_CPPv3N20PowerSupplyComponent16active_requests_E"><span id="_CPPv2N20PowerSupplyComponent16active_requests_E"></span><span id="PowerSupplyComponent::active_requests___int16_t"></span><span class="target"id="class_power_supply_component_1ad5ac1bbba98edc50dca1fe22a1fb4dce"></span>int16_t <a class="reference internal"href="#_CPPv320PowerSupplyComponent"title="PowerSupplyComponent">PowerSupplyComponent</a><code class="descname">active_requests_</code> = {0}<a class="headerlink"href="#_CPPv3N20PowerSupplyComponent16active_requests_E"title="Permalink to this definition">¶</a><br><dd></dl></div></dl></div></div></div></div></div></div><div class="sphinxsidebar"role="navigation"aria-label="main navigation"><div class="sphinxsidebarwrapper"><div class="relations"><h3>Related Topics</h3><ul><li><a href="../../index.html">Documentation overview</a><ul><li><a href="../index.html">API Reference</a><ul><li><a href="index.html">Core</a><ul><li>Previous: <a href="log.html"title="previous chapter">Logging Engine</a><li>Next: <a href="controller.html"title="next chapter">Controller</a></ul></ul></ul></ul></div><div id="searchbox"style="display: none"role="search"><h3>Quick search</h3><div class="searchformwrapper"><form class="search"action="../../search.html"><input name="q"> <input type="submit"value="Go"> <input type="hidden"name="check_keywords"value="yes"> <input type="hidden"name="area"value="default"></form></div></div><script>$('#searchbox').show(0);</script></div></div><div class="clearer"></div></div><div class="footer">&copy;2018, Otto Winter. | Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.2</a> &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a> | <a href="../../_sources/api/core/power-supply.rst.txt"rel="nofollow">Page source</a></div>